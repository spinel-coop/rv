#!/usr/bin/env bash
set -euo pipefail

# Smoke test for Discourse
# https://github.com/discourse/discourse
#
# Uses Docker multi-stage build:
# - Stage 1: Build rv from source
# - Stage 2: Run rv ci in discourse/base image

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"
IMAGE_NAME="rv-smoke-discourse"

echo "Building Docker image and running smoke test..."
docker build -f "$SCRIPT_DIR/discourse.Dockerfile" -t "$IMAGE_NAME" "$ROOT_DIR"

echo ""
echo "Smoke test for discourse passed!"
