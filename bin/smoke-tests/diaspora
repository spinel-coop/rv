#!/bin/bash
set -euo pipefail

# Smoke test for Diaspora - https://github.com/diaspora/diaspora

source "$(dirname "$0")/shared.sh"

macos_docker_reexec

setup_packages \
    libyaml-dev \
    libffi-dev \
    libxml2-dev \
    libxslt-dev \
    libpq-dev \
    default-libmysqlclient-dev \
    libcurl4-openssl-dev \
    libyajl-dev \
    libmagickwand-dev \
    libgit2-dev \
    libssh2-1-dev \
    libidn-dev \
    cmake \
    pkg-config

setup_rv

[[ -d diaspora ]] || git clone --depth 1 https://github.com/diaspora/diaspora.git
cd diaspora

rv ci

rv run bundle check

smoke_test_success "diaspora"
