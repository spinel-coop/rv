#!/usr/bin/env bash
set -euo pipefail

# Smoke test for Fastlane
# https://github.com/fastlane/fastlane
#
# Uses Docker multi-stage build:
# - Stage 1: Build rv from source
# - Stage 2: Clone fastlane, install Ruby via rv, run rv ci

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"
IMAGE_NAME="rv-smoke-fastlane"

echo "Building Docker image and running smoke test..."
docker build -f "$SCRIPT_DIR/fastlane.Dockerfile" -t "$IMAGE_NAME" "$ROOT_DIR"

echo ""
echo "Smoke test for fastlane passed!"
