#!/bin/bash
set -euo pipefail

# Smoke test for Fastlane - https://github.com/fastlane/fastlane

source "$(dirname "$0")/shared.sh"

macos_docker_reexec

setup_packages \
    libyaml-dev \
    libffi-dev \
    libssl-dev

setup_rv

[[ -d fastlane ]] || git clone --depth 1 https://github.com/fastlane/fastlane.git
cd fastlane

# Fastlane has no .ruby-version file or Ruby version in Gemfile.lock
# https://docs.fastlane.tools/ says "fastlane supports Ruby versions 2.5 or newer"
echo "3.3" > .ruby-version

rv ci

rv run bundle check

smoke_test_success "fastlane"
