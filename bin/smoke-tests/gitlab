#!/bin/bash
set -euo pipefail

# Smoke test for GitLab - https://gitlab.com/gitlab-org/gitlab

source "$(dirname "$0")/shared.sh"

macos_docker_reexec

setup_packages \
    libyaml-dev \
    libre2-dev \
    libffi-dev \
    libxml2-dev \
    libxslt-dev \
    libcurl4-openssl-dev \
    libicu-dev \
    libkrb5-dev \
    libpq-dev \
    libpcre2-dev \
    libgpgme-dev \
    zlib1g-dev \
    cmake \
    pkg-config

setup_rv

[[ -d gitlab ]] || git clone --depth 1 https://gitlab.com/gitlab-org/gitlab.git
cd gitlab

rv ci

smoke_test_success "gitlab"
